<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Particle Effects Demo</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      height: 100vh;
      overflow: hidden;
      color: #fff;
    }
    .container {
      display: flex;
      max-width: 1600px;
      margin: 0 auto;
      padding: 20px;
      gap: 20px;
      height: 100vh;
      overflow: hidden;
    }
    /* Sidebar */
    .sidebar {
      width: 280px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 15px;
      height: calc(100vh - 40px);
      overflow-y: auto;
    }
    .sidebar-header {
      text-align: center;
      padding: 15px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
    }
    .sidebar-header h2 {
      font-size: 1.2rem;
      margin-bottom: 5px;
      background: linear-gradient(90deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .sidebar-header .count { color: #667eea; font-weight: bold; }
    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
    }
    .tab {
      padding: 6px 12px;
      background: rgba(255, 255, 255, 0.1);
      border: none; border-radius: 6px;
      color: #fff; cursor: pointer;
      transition: all 0.3s; font-size: 0.8rem;
      flex: 1;
      min-width: 70px;
      text-align: center;
    }
    .tab:hover { background: rgba(255, 255, 255, 0.2); }
    .tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .search-input {
      width: 100%;
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: #fff;
      font-size: 0.85rem;
    }
    .search-input::placeholder { color: #888; }
    .search-input:focus { outline: none; border-color: #667eea; }
    .effects-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
    }
    .effect-btn {
      padding: 12px 8px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px; color: #fff;
      cursor: pointer; transition: all 0.2s;
      font-size: 0.75rem; text-align: center;
    }
    .effect-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.3);
    }
    .effect-btn.selected {
      background: rgba(102, 126, 234, 0.3);
      border-color: #667eea;
    }
    /* Main content */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 15px;
      min-width: 0;
    }
    header {
      text-align: center;
      padding: 15px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 5px;
      background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcb77, #4d96ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .subtitle { color: #888; font-size: 0.9rem; }
    .canvas-container {
      position: relative;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 15px;
      overflow: hidden;
      flex: 1;
      min-height: 400px;
    }
    #canvas {
      display: block;
      cursor: crosshair;
    }
    .canvas-hint {
      position: absolute; bottom: 10px; left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.6);
      padding: 6px 12px; border-radius: 20px;
      font-size: 0.75rem; color: #aaa;
      pointer-events: none;
    }
    .controls {
      display: flex; flex-direction: column; gap: 10px;
      padding: 15px; background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
    }
    .control-group { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .control-buttons { display: flex; gap: 8px; }
    .control-buttons .action-btn { flex: 1; }
    .control-group label { font-size: 0.8rem; color: #aaa; }
    .control-group input[type="range"] { width: 100px; accent-color: #667eea; }
    .action-btn {
      padding: 8px 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none; border-radius: 8px;
      color: #fff; cursor: pointer; font-size: 0.85rem;
    }
    .action-btn:hover { transform: scale(1.05); }
    .action-btn.auto-active,
    .action-btn.random-active {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    .last-effect {
      font-size: 0.8rem; color: #aaa;
      padding: 8px; text-align: center;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }
    .last-effect span { color: #667eea; font-weight: bold; }
    .stats {
      display: flex; gap: 20px; justify-content: center;
      font-size: 0.8rem; color: #888;
      padding: 10px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }
    .stat { display: flex; align-items: center; gap: 5px; }
    .stat-value { font-weight: bold; color: #fff; }
    /* Responsive */
    @media (max-width: 900px) {
      .container {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        max-height: 300px;
      }
      .effects-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Effects</h2>
        <p><span class="count" id="effectCount">0</span> available</p>
      </div>
      <div class="controls">
        <div class="control-group">
          <label>Intensity:</label>
          <input type="range" id="intensity" min="0.5" max="3" step="0.1" value="1">
          <span id="intensityValue">1.0</span>
        </div>
        <div class="control-buttons">
          <button class="action-btn" id="autoBtn">Auto Play</button>
          <button class="action-btn" id="randomBtn">Random</button>
          <button class="action-btn" id="clearBtn">Clear</button>
        </div>
      </div>
      <div class="last-effect">Last: <span id="lastEffect">-</span></div>
      <input type="text" id="searchInput" placeholder="Search effects..." class="search-input">
      <div class="tabs" id="tabs"></div>
      <div class="effects-grid" id="effectsGrid"></div>
    </aside>
    <!-- Main Content -->
    <main class="main-content">
      <header>
        <h1>Particle Effects</h1>
        <p class="subtitle">Canvas TypeScript Particle System</p>
      </header>
      <div class="canvas-container">
        <canvas id="canvas"></canvas>
        <div class="canvas-hint">Click anywhere to trigger effect</div>
      </div>
      <div class="stats">
        <div class="stat">FPS: <span class="stat-value" id="fps">0</span></div>
        <div class="stat">Particles: <span class="stat-value" id="particleCount">0</span></div>
      </div>
    </main>
  </div>

  <script type="module">
    // === Pure function for random effect selection (testable) ===
    function selectRandomEffect(effects, randomFn = Math.random) {
      if (!effects.length) return null;
      return effects[Math.floor(randomFn() * effects.length)];
    }

    // === Pure function for filtering effects by category ===
    function getFilteredEffects(effects, category, effectMeta) {
      if (category === 'all') return effects;
      return effects.filter(e => {
        const meta = effectMeta[e.config.name];
        return meta && meta.category === category;
      });
    }

    // === Table-driven tests (Go-style TDD) ===
    function runTests() {
      let passed = 0;
      let total = 0;

      // selectRandomEffect tests
      const randomTests = [
        { effects: [], random: 0, want: null },
        { effects: [{name:'a'},{name:'b'},{name:'c'}], random: 0, wantName: 'a' },
        { effects: [{name:'a'},{name:'b'},{name:'c'}], random: 0.33, wantName: 'a' },
        { effects: [{name:'a'},{name:'b'},{name:'c'}], random: 0.34, wantName: 'b' },
        { effects: [{name:'a'},{name:'b'},{name:'c'}], random: 0.5, wantName: 'b' },
        { effects: [{name:'a'},{name:'b'},{name:'c'}], random: 0.67, wantName: 'c' },
        { effects: [{name:'a'},{name:'b'},{name:'c'}], random: 0.99, wantName: 'c' },
      ];
      console.log('--- selectRandomEffect ---');
      randomTests.forEach((t, i) => {
        total++;
        const got = selectRandomEffect(t.effects, () => t.random);
        const gotName = got ? got.name : null;
        const want = t.wantName ?? t.want;
        if (gotName === want) { console.log(`âœ“ random[${i}]`); passed++; }
        else { console.error(`âœ— random[${i}]: got ${gotName}, want ${want}`); }
      });

      // getFilteredEffects tests
      const meta = { a: { category: 'ui' }, b: { category: 'visual' }, c: { category: 'ui' } };
      const effects = [{ config: { name: 'a' } }, { config: { name: 'b' } }, { config: { name: 'c' } }];
      const filterTests = [
        { category: 'all', wantLength: 3 },
        { category: 'ui', wantLength: 2 },
        { category: 'visual', wantLength: 1 },
        { category: 'game', wantLength: 0 },
      ];
      console.log('--- getFilteredEffects ---');
      filterTests.forEach((t, i) => {
        total++;
        const got = getFilteredEffects(effects, t.category, meta);
        if (got.length === t.wantLength) { console.log(`âœ“ filter[${i}] ${t.category}`); passed++; }
        else { console.error(`âœ— filter[${i}] ${t.category}: got ${got.length}, want ${t.wantLength}`); }
      });

      console.log(`${passed}/${total} passed`);
    }
    // Expose to console: window.runTests()
    window.runTests = runTests;

    // Effect definitions with categories and emojis (å…¨501å€‹)
    const EFFECT_META = {
      // === A ===
      absorb: { category: 'game', emoji: 'ðŸ§²' },
      alarm: { category: 'ui', emoji: 'â°' },
      alert: { category: 'ui', emoji: 'ðŸš¨' },
      anger: { category: 'visual', emoji: 'ðŸ˜ ' },
      apple: { category: 'visual', emoji: 'ðŸŽ' },
      aqua: { category: 'visual', emoji: 'ðŸ’§' },
      arch: { category: 'visual', emoji: 'ðŸŒ‰' },
      arrow: { category: 'ui', emoji: 'âž¡ï¸' },
      asteroid: { category: 'background', emoji: 'ðŸª¨' },
      aura: { category: 'game', emoji: 'ðŸ‘¼' },
      aura2: { category: 'game', emoji: 'ðŸ˜‡' },
      aurora: { category: 'visual', emoji: 'ðŸŒˆ' },
      aurora2: { category: 'visual', emoji: 'ðŸŽ¨' },
      // === B ===
      badge: { category: 'ui', emoji: 'ðŸ…' },
      balance2: { category: 'visual', emoji: 'âš–ï¸' },
      bamboo: { category: 'visual', emoji: 'ðŸŽ‹' },
      baseball: { category: 'visual', emoji: 'âš¾' },
      basketball: { category: 'visual', emoji: 'ðŸ€' },
      bass: { category: 'visual', emoji: 'ðŸŽ¸' },
      battery: { category: 'ui', emoji: 'ðŸ”‹' },
      beam: { category: 'visual', emoji: 'ðŸ“¡' },
      beat: { category: 'visual', emoji: 'ðŸ¥' },
      bee: { category: 'visual', emoji: 'ðŸ' },
      beer: { category: 'visual', emoji: 'ðŸº' },
      bell2: { category: 'ui', emoji: 'ðŸ””' },
      bike: { category: 'visual', emoji: 'ðŸš´' },
      binary: { category: 'visual', emoji: 'ðŸ”¢' },
      bird: { category: 'visual', emoji: 'ðŸ¦' },
      blackhole: { category: 'visual', emoji: 'ðŸ•³ï¸' },
      bleed: { category: 'game', emoji: 'ðŸ©¸' },
      bless: { category: 'game', emoji: 'ðŸ™' },
      blizzard: { category: 'visual', emoji: 'ðŸŒ¨ï¸' },
      block: { category: 'game', emoji: 'ðŸ§±' },
      bloom: { category: 'visual', emoji: 'ðŸŒº' },
      bluetooth: { category: 'ui', emoji: 'ðŸ“¶' },
      blush: { category: 'visual', emoji: 'ðŸ˜Š' },
      bolt: { category: 'visual', emoji: 'âš¡' },
      bolt2: { category: 'visual', emoji: 'ðŸ”©' },
      boost: { category: 'game', emoji: 'ðŸš€' },
      bounce: { category: 'visual', emoji: 'ðŸ' },
      bridge: { category: 'visual', emoji: 'ðŸŒ' },
      broadcast: { category: 'ui', emoji: 'ðŸ“»' },
      bubble: { category: 'background', emoji: 'ðŸ«§' },
      buff: { category: 'game', emoji: 'ðŸ’ª' },
      burn: { category: 'game', emoji: 'ðŸ”¥' },
      burn2: { category: 'game', emoji: 'ðŸ¥µ' },
      butterfly: { category: 'visual', emoji: 'ðŸ¦‹' },
      // === C ===
      cactus: { category: 'visual', emoji: 'ðŸŒµ' },
      cake: { category: 'visual', emoji: 'ðŸŽ‚' },
      calendar: { category: 'ui', emoji: 'ðŸ“…' },
      calm: { category: 'visual', emoji: 'ðŸ˜Œ' },
      camera: { category: 'ui', emoji: 'ðŸ“·' },
      cancel: { category: 'ui', emoji: 'ðŸš«' },
      candy: { category: 'visual', emoji: 'ðŸ¬' },
      card: { category: 'visual', emoji: 'ðŸƒ' },
      cascade: { category: 'visual', emoji: 'ðŸŒŠ' },
      cat: { category: 'visual', emoji: 'ðŸ±' },
      celestial: { category: 'visual', emoji: 'ðŸŒŸ' },
      ceramic: { category: 'visual', emoji: 'ðŸº' },
      chain: { category: 'visual', emoji: 'â›“ï¸' },
      chaos2: { category: 'visual', emoji: 'ðŸŒ€' },
      charge: { category: 'game', emoji: 'âš¡' },
      chat: { category: 'ui', emoji: 'ðŸ’¬' },
      checker: { category: 'visual', emoji: 'ðŸ' },
      chi: { category: 'game', emoji: 'â˜¯ï¸' },
      chip: { category: 'visual', emoji: 'ðŸŽ°' },
      chorus: { category: 'visual', emoji: 'ðŸŽ¶' },
      circle: { category: 'visual', emoji: 'â­•' },
      circuit: { category: 'visual', emoji: 'ðŸ”Œ' },
      circular: { category: 'visual', emoji: 'ðŸ”„' },
      clash: { category: 'game', emoji: 'âš”ï¸' },
      click: { category: 'ui', emoji: 'ðŸ‘†' },
      clock: { category: 'ui', emoji: 'ðŸ•' },
      cloud: { category: 'background', emoji: 'â˜ï¸' },
      clover: { category: 'visual', emoji: 'ðŸ€' },
      code: { category: 'visual', emoji: 'ðŸ‘¨â€ðŸ’»' },
      coffee: { category: 'visual', emoji: 'â˜•' },
      cog: { category: 'visual', emoji: 'âš™ï¸' },
      coil: { category: 'visual', emoji: 'ðŸ§¬' },
      coin: { category: 'visual', emoji: 'ðŸª™' },
      combo: { category: 'game', emoji: 'ðŸ”¥' },
      combo2: { category: 'game', emoji: 'ðŸ’¯' },
      comet: { category: 'background', emoji: 'â˜„ï¸' },
      concentric: { category: 'visual', emoji: 'ðŸŽ¯' },
      confetti: { category: 'ui', emoji: 'ðŸŽŠ' },
      confirm: { category: 'ui', emoji: 'âœ…' },
      constellation: { category: 'background', emoji: 'ðŸŒŒ' },
      contract: { category: 'visual', emoji: 'ðŸ“œ' },
      cookie: { category: 'visual', emoji: 'ðŸª' },
      corona: { category: 'visual', emoji: 'ðŸ‘‘' },
      cosmos: { category: 'background', emoji: 'ðŸŒ ' },
      countdown: { category: 'ui', emoji: 'â±ï¸' },
      counter: { category: 'game', emoji: 'ðŸ”¢' },
      critical: { category: 'game', emoji: 'ðŸ’¥' },
      cross: { category: 'visual', emoji: 'âœï¸' },
      crown: { category: 'visual', emoji: 'ðŸ‘‘' },
      crystal: { category: 'visual', emoji: 'ðŸ’Ž' },
      crystal2: { category: 'visual', emoji: 'ðŸ”®' },
      cube: { category: 'visual', emoji: 'ðŸ§Š' },
      curious: { category: 'visual', emoji: 'ðŸ¤”' },
      current: { category: 'visual', emoji: 'ðŸŒ€' },
      curse: { category: 'game', emoji: 'ðŸ§¿' },
      curtain: { category: 'visual', emoji: 'ðŸŽ­' },
      cut: { category: 'game', emoji: 'âœ‚ï¸' },
      cyber: { category: 'visual', emoji: 'ðŸ¤–' },
      cyclone: { category: 'visual', emoji: 'ðŸŒ€' },
      // === D ===
      damage: { category: 'game', emoji: 'ðŸ’”' },
      dash: { category: 'game', emoji: 'ðŸ’¨' },
      data: { category: 'visual', emoji: 'ðŸ“Š' },
      deadline: { category: 'ui', emoji: 'â°' },
      death: { category: 'game', emoji: 'ðŸ’€' },
      debuff: { category: 'game', emoji: 'ðŸ“‰' },
      decrypt: { category: 'visual', emoji: 'ðŸ”“' },
      despair: { category: 'visual', emoji: 'ðŸ˜°' },
      dew: { category: 'visual', emoji: 'ðŸ’§' },
      diamond: { category: 'visual', emoji: 'ðŸ’ ' },
      dice: { category: 'visual', emoji: 'ðŸŽ²' },
      diffraction: { category: 'visual', emoji: 'ðŸŒˆ' },
      dimension: { category: 'visual', emoji: 'ðŸ”²' },
      discord: { category: 'visual', emoji: 'ðŸ’¢' },
      dislike: { category: 'ui', emoji: 'ðŸ‘Ž' },
      dissolve: { category: 'visual', emoji: 'ðŸ« ' },
      dissolve3: { category: 'visual', emoji: 'ðŸ’¨' },
      division: { category: 'visual', emoji: 'âž—' },
      dizzy: { category: 'visual', emoji: 'ðŸ˜µ' },
      dodge: { category: 'game', emoji: 'ðŸƒ' },
      dog: { category: 'visual', emoji: 'ðŸ•' },
      dome: { category: 'visual', emoji: 'ðŸ›ï¸' },
      dots: { category: 'visual', emoji: 'ðŸ”˜' },
      download: { category: 'ui', emoji: 'ðŸ“¥' },
      dragon: { category: 'visual', emoji: 'ðŸ‰' },
      drain: { category: 'game', emoji: 'ðŸ©¸' },
      dream: { category: 'visual', emoji: 'ðŸ’­' },
      drip: { category: 'visual', emoji: 'ðŸ’§' },
      drizzle: { category: 'background', emoji: 'ðŸŒ¦ï¸' },
      drone: { category: 'visual', emoji: 'ðŸ›¸' },
      drop: { category: 'visual', emoji: 'ðŸ’§' },
      droplet: { category: 'visual', emoji: 'ðŸ’¦' },
      drum: { category: 'visual', emoji: 'ðŸ¥' },
      dust: { category: 'background', emoji: 'ðŸŒ«ï¸' },
      // === E ===
      earthquake: { category: 'visual', emoji: 'ðŸŒ‹' },
      echo2: { category: 'visual', emoji: 'ðŸ”Š' },
      eclipse: { category: 'visual', emoji: 'ðŸŒ‘' },
      electric: { category: 'visual', emoji: 'âš¡' },
      electron: { category: 'visual', emoji: 'âš›ï¸' },
      empathy: { category: 'visual', emoji: 'ðŸ¤' },
      encrypt: { category: 'visual', emoji: 'ðŸ”' },
      energy: { category: 'game', emoji: 'âš¡' },
      engine: { category: 'visual', emoji: 'ðŸŽï¸' },
      entropy: { category: 'visual', emoji: 'ðŸŽ²' },
      envy: { category: 'visual', emoji: 'ðŸ˜’' },
      equalizer: { category: 'visual', emoji: 'ðŸŽšï¸' },
      error: { category: 'ui', emoji: 'âŒ' },
      essence: { category: 'game', emoji: 'ðŸ§ª' },
      ethereal: { category: 'visual', emoji: 'ðŸ‘»' },
      excited: { category: 'visual', emoji: 'ðŸ¤©' },
      exclaim: { category: 'ui', emoji: 'â—' },
      expand: { category: 'visual', emoji: 'ðŸ“ˆ' },
      explosion: { category: 'visual', emoji: 'ðŸ’¥' },
      eye: { category: 'visual', emoji: 'ðŸ‘ï¸' },
      // === F ===
      fabric: { category: 'visual', emoji: 'ðŸ§µ' },
      factory: { category: 'visual', emoji: 'ðŸ­' },
      fade2: { category: 'visual', emoji: 'ðŸŒ«ï¸' },
      fall: { category: 'visual', emoji: 'ðŸ‚' },
      fear: { category: 'visual', emoji: 'ðŸ˜¨' },
      feather: { category: 'visual', emoji: 'ðŸª¶' },
      fern: { category: 'visual', emoji: 'ðŸŒ¿' },
      finisher: { category: 'game', emoji: 'ðŸ†' },
      fire: { category: 'visual', emoji: 'ðŸ”¥' },
      fireflies: { category: 'background', emoji: 'ðŸª²' },
      firefly: { category: 'background', emoji: 'ðŸª²' },
      firewall: { category: 'visual', emoji: 'ðŸ§±' },
      fireworks: { category: 'visual', emoji: 'ðŸŽ†' },
      fish: { category: 'visual', emoji: 'ðŸŸ' },
      flame: { category: 'visual', emoji: 'ðŸ”¥' },
      flicker: { category: 'visual', emoji: 'ðŸ•¯ï¸' },
      flip2: { category: 'visual', emoji: 'ðŸ”„' },
      float: { category: 'visual', emoji: 'ðŸŽˆ' },
      flock: { category: 'visual', emoji: 'ðŸ¦' },
      flood: { category: 'visual', emoji: 'ðŸŒŠ' },
      flow2: { category: 'visual', emoji: 'ã€°ï¸' },
      flower: { category: 'visual', emoji: 'ðŸŒ¸' },
      focus: { category: 'ui', emoji: 'ðŸŽ¯' },
      fog: { category: 'background', emoji: 'ðŸŒ«ï¸' },
      force: { category: 'game', emoji: 'ðŸ’ª' },
      fountain: { category: 'visual', emoji: 'â›²' },
      freeze: { category: 'game', emoji: 'ðŸ§Š' },
      freeze2: { category: 'game', emoji: 'â„ï¸' },
      frost: { category: 'visual', emoji: 'ðŸ¥¶' },
      fusion2: { category: 'visual', emoji: 'ðŸ”®' },
      // === G ===
      galaxy: { category: 'visual', emoji: 'ðŸŒŒ' },
      gate: { category: 'visual', emoji: 'ðŸšª' },
      gather: { category: 'visual', emoji: 'ðŸ§²' },
      gear: { category: 'visual', emoji: 'âš™ï¸' },
      gem: { category: 'visual', emoji: 'ðŸ’Ž' },
      gem2: { category: 'visual', emoji: 'ðŸ’' },
      genesis: { category: 'visual', emoji: 'ðŸŒ…' },
      geyser: { category: 'visual', emoji: 'â™¨ï¸' },
      glass: { category: 'visual', emoji: 'ðŸ¥›' },
      glitch: { category: 'visual', emoji: 'ðŸ“º' },
      glow2: { category: 'visual', emoji: 'ðŸ’¡' },
      golf: { category: 'visual', emoji: 'â›³' },
      gps: { category: 'ui', emoji: 'ðŸ“' },
      grab: { category: 'game', emoji: 'ðŸ«³' },
      grid: { category: 'visual', emoji: 'ðŸ“' },
      grief: { category: 'visual', emoji: 'ðŸ˜¢' },
      guilt: { category: 'visual', emoji: 'ðŸ˜”' },
      guitar: { category: 'visual', emoji: 'ðŸŽ¸' },
      // === H ===
      hack: { category: 'visual', emoji: 'ðŸ‘¨â€ðŸ’»' },
      hail: { category: 'visual', emoji: 'ðŸŒ¨ï¸' },
      harmony2: { category: 'visual', emoji: 'ðŸŽµ' },
      hashtag: { category: 'ui', emoji: '#ï¸âƒ£' },
      haste: { category: 'game', emoji: 'â©' },
      haze: { category: 'background', emoji: 'ðŸŒ' },
      headphone: { category: 'visual', emoji: 'ðŸŽ§' },
      heal: { category: 'game', emoji: 'ðŸ’š' },
      heart2: { category: 'visual', emoji: 'â¤ï¸' },
      heartbeat: { category: 'ui', emoji: 'ðŸ’“' },
      helix: { category: 'visual', emoji: 'ðŸ§¬' },
      herd: { category: 'visual', emoji: 'ðŸ‘' },
      hexagon: { category: 'visual', emoji: 'â¬¡' },
      hexgrid: { category: 'visual', emoji: 'ðŸ”·' },
      hologram: { category: 'visual', emoji: 'ðŸ“½ï¸' },
      hope: { category: 'visual', emoji: 'ðŸŒž' },
      hourglass: { category: 'ui', emoji: 'â³' },
      hurricane: { category: 'visual', emoji: 'ðŸŒ€' },
      // === I ===
      icecream: { category: 'visual', emoji: 'ðŸ¦' },
      impact: { category: 'game', emoji: 'ðŸ’¢' },
      index: { category: 'visual', emoji: 'ðŸ“‘' },
      infinity2: { category: 'visual', emoji: 'â™¾ï¸' },
      interference: { category: 'visual', emoji: 'ðŸ“¶' },
      // === J ===
      jackpot: { category: 'game', emoji: 'ðŸŽ°' },
      joy: { category: 'visual', emoji: 'ðŸ˜„' },
      jump: { category: 'game', emoji: 'ðŸ¦˜' },
      // === K ===
      kick: { category: 'game', emoji: 'ðŸ¦¶' },
      // === L ===
      land: { category: 'visual', emoji: 'ðŸžï¸' },
      laptop: { category: 'visual', emoji: 'ðŸ’»' },
      laser: { category: 'visual', emoji: 'ðŸ”´' },
      laugh: { category: 'visual', emoji: 'ðŸ˜‚' },
      leaf: { category: 'visual', emoji: 'ðŸƒ' },
      leather: { category: 'visual', emoji: 'ðŸ§¥' },
      leaves: { category: 'background', emoji: 'ðŸ‚' },
      lens: { category: 'visual', emoji: 'ðŸ”' },
      levelup: { category: 'game', emoji: 'â¬†ï¸' },
      lightning: { category: 'visual', emoji: 'ðŸŒ©ï¸' },
      like: { category: 'ui', emoji: 'ðŸ‘' },
      link: { category: 'ui', emoji: 'ðŸ”—' },
      loading: { category: 'ui', emoji: 'â³' },
      lock: { category: 'ui', emoji: 'ðŸ”’' },
      love: { category: 'visual', emoji: 'ðŸ’•' },
      // === M ===
      machine: { category: 'visual', emoji: 'ðŸ¤–' },
      magic: { category: 'visual', emoji: 'ðŸª„' },
      mail: { category: 'ui', emoji: 'ðŸ“§' },
      mana: { category: 'game', emoji: 'ðŸ”µ' },
      matrix: { category: 'visual', emoji: 'ðŸ’»' },
      medal: { category: 'ui', emoji: 'ðŸ…' },
      melody: { category: 'visual', emoji: 'ðŸŽµ' },
      merge: { category: 'visual', emoji: 'ðŸ”€' },
      metal: { category: 'visual', emoji: 'ðŸ”©' },
      meteor: { category: 'visual', emoji: 'â˜„ï¸' },
      meteor2: { category: 'visual', emoji: 'ðŸŒ ' },
      microphone: { category: 'visual', emoji: 'ðŸŽ¤' },
      mist: { category: 'background', emoji: 'ðŸŒ«ï¸' },
      monsoon: { category: 'visual', emoji: 'ðŸŒ§ï¸' },
      moon: { category: 'visual', emoji: 'ðŸŒ™' },
      moon2: { category: 'visual', emoji: 'ðŸŒ›' },
      moonlight: { category: 'background', emoji: 'ðŸŒ•' },
      moonphase: { category: 'visual', emoji: 'ðŸŒ˜' },
      morph: { category: 'visual', emoji: 'ðŸ¦Ž' },
      mushroom: { category: 'visual', emoji: 'ðŸ„' },
      music: { category: 'visual', emoji: 'ðŸŽµ' },
      // === N ===
      nebula: { category: 'visual', emoji: 'ðŸŒŒ' },
      neon: { category: 'visual', emoji: 'ðŸ’¡' },
      network: { category: 'background', emoji: 'ðŸŒ' },
      neutron: { category: 'visual', emoji: 'âš›ï¸' },
      noise: { category: 'visual', emoji: 'ðŸ“¢' },
      notification: { category: 'ui', emoji: 'ðŸ””' },
      // === O ===
      omega: { category: 'visual', emoji: 'Î©' },
      orange: { category: 'visual', emoji: 'ðŸŠ' },
      orbit2: { category: 'visual', emoji: 'ðŸ›°ï¸' },
      orbit3: { category: 'visual', emoji: 'ðŸª' },
      order: { category: 'visual', emoji: 'ðŸ“‹' },
      overcast: { category: 'background', emoji: 'â˜ï¸' },
      // === P ===
      paralyze: { category: 'game', emoji: 'ðŸ˜µ' },
      parry: { category: 'game', emoji: 'ðŸ¤º' },
      path: { category: 'visual', emoji: 'ðŸ›¤ï¸' },
      pentagon: { category: 'visual', emoji: 'â¬ ' },
      phoenix: { category: 'visual', emoji: 'ðŸ¦…' },
      phone: { category: 'ui', emoji: 'ðŸ“±' },
      photon: { category: 'visual', emoji: 'ðŸ’¡' },
      piano: { category: 'visual', emoji: 'ðŸŽ¹' },
      pierce: { category: 'game', emoji: 'ðŸ—¡ï¸' },
      pillar: { category: 'visual', emoji: 'ðŸ—¿' },
      piston: { category: 'visual', emoji: 'ðŸ”§' },
      pixel2: { category: 'visual', emoji: 'ðŸŽ®' },
      pizza: { category: 'visual', emoji: 'ðŸ•' },
      planetring: { category: 'visual', emoji: 'ðŸª' },
      plasma: { category: 'visual', emoji: 'ðŸŸ£' },
      plastic: { category: 'visual', emoji: 'ðŸ§´' },
      poison: { category: 'game', emoji: 'â˜ ï¸' },
      poison2: { category: 'game', emoji: 'ðŸ§ª' },
      pollen: { category: 'background', emoji: 'ðŸŒ¼' },
      pool: { category: 'visual', emoji: 'ðŸŽ±' },
      portal: { category: 'visual', emoji: 'ðŸŒ€' },
      pour: { category: 'visual', emoji: 'ðŸ«—' },
      power: { category: 'game', emoji: 'âš¡' },
      powerup: { category: 'game', emoji: 'ðŸ†™' },
      pride: { category: 'visual', emoji: 'ðŸ³ï¸â€ðŸŒˆ' },
      primordial: { category: 'visual', emoji: 'ðŸŒ‹' },
      prism: { category: 'visual', emoji: 'ðŸ”·' },
      progress2: { category: 'ui', emoji: 'ðŸ“Š' },
      proton: { category: 'visual', emoji: 'âš›ï¸' },
      pulsar: { category: 'visual', emoji: 'ðŸ’«' },
      pulse: { category: 'visual', emoji: 'ðŸ’—' },
      punch: { category: 'game', emoji: 'ðŸ‘Š' },
      pyramid: { category: 'visual', emoji: 'ðŸ”º' },
      // === Q ===
      quantum: { category: 'visual', emoji: 'âš›ï¸' },
      quasar: { category: 'visual', emoji: 'ðŸŒŸ' },
      question: { category: 'ui', emoji: 'â“' },
      // === R ===
      radial: { category: 'visual', emoji: 'â˜€ï¸' },
      radiance: { category: 'visual', emoji: 'ðŸŒŸ' },
      rage: { category: 'visual', emoji: 'ðŸ˜¡' },
      rain: { category: 'visual', emoji: 'ðŸŒ§ï¸' },
      rainbow: { category: 'visual', emoji: 'ðŸŒˆ' },
      rank: { category: 'ui', emoji: 'ðŸ†' },
      record: { category: 'visual', emoji: 'ðŸ“€' },
      reflect: { category: 'visual', emoji: 'ðŸªž' },
      reflect2: { category: 'visual', emoji: 'ðŸ’ ' },
      refract: { category: 'visual', emoji: 'ðŸŒˆ' },
      regen: { category: 'game', emoji: 'ðŸ’–' },
      reverb: { category: 'visual', emoji: 'ðŸ”Š' },
      revive: { category: 'game', emoji: 'ðŸ’«' },
      rhythm: { category: 'visual', emoji: 'ðŸŽ¼' },
      ribbon: { category: 'visual', emoji: 'ðŸŽ€' },
      ring: { category: 'visual', emoji: 'ðŸ’' },
      ripple: { category: 'visual', emoji: 'ã€°ï¸' },
      ripple2: { category: 'visual', emoji: 'ðŸŒ€' },
      rise: { category: 'visual', emoji: 'ðŸ“ˆ' },
      robot: { category: 'visual', emoji: 'ðŸ¤–' },
      rocket: { category: 'visual', emoji: 'ðŸš€' },
      roof: { category: 'visual', emoji: 'ðŸ ' },
      rose: { category: 'visual', emoji: 'ðŸŒ¹' },
      rotate3: { category: 'visual', emoji: 'ðŸ”„' },
      roulette: { category: 'visual', emoji: 'ðŸŽ°' },
      runner: { category: 'visual', emoji: 'ðŸƒ' },
      rush: { category: 'game', emoji: 'ðŸ’¨' },
      // === S ===
      sad: { category: 'visual', emoji: 'ðŸ˜¢' },
      sakura: { category: 'background', emoji: 'ðŸŒ¸' },
      sandstorm: { category: 'visual', emoji: 'ðŸœï¸' },
      satellite: { category: 'visual', emoji: 'ðŸ›°ï¸' },
      save: { category: 'ui', emoji: 'ðŸ’¾' },
      scale2: { category: 'visual', emoji: 'âš–ï¸' },
      scan: { category: 'ui', emoji: 'ðŸ“¡' },
      scatter: { category: 'visual', emoji: 'ðŸ’«' },
      schedule: { category: 'ui', emoji: 'ðŸ“…' },
      school: { category: 'visual', emoji: 'ðŸ«' },
      score: { category: 'game', emoji: 'ðŸ”¢' },
      search: { category: 'ui', emoji: 'ðŸ”' },
      serenity: { category: 'visual', emoji: 'ðŸ˜Œ' },
      shake: { category: 'visual', emoji: 'ðŸ“³' },
      shame: { category: 'visual', emoji: 'ðŸ˜³' },
      share: { category: 'ui', emoji: 'ðŸ“¤' },
      shield: { category: 'game', emoji: 'ðŸ›¡ï¸' },
      shimmer: { category: 'visual', emoji: 'ðŸŒŸ' },
      shock2: { category: 'game', emoji: 'ðŸ˜²' },
      shockwave: { category: 'visual', emoji: 'ðŸ’¢' },
      shooting: { category: 'visual', emoji: 'ðŸŒ ' },
      shutter: { category: 'visual', emoji: 'ðŸ“·' },
      signal: { category: 'ui', emoji: 'ðŸ“¶' },
      silence: { category: 'visual', emoji: 'ðŸ¤«' },
      sine: { category: 'visual', emoji: 'ã€°ï¸' },
      skate: { category: 'visual', emoji: 'â›¸ï¸' },
      ski: { category: 'visual', emoji: 'â›·ï¸' },
      skull: { category: 'visual', emoji: 'ðŸ’€' },
      slash: { category: 'game', emoji: 'âš”ï¸' },
      sleepy: { category: 'visual', emoji: 'ðŸ˜´' },
      sleet: { category: 'visual', emoji: 'ðŸŒ¨ï¸' },
      slide: { category: 'visual', emoji: 'ðŸ›' },
      slot: { category: 'visual', emoji: 'ðŸŽ°' },
      slow: { category: 'game', emoji: 'ðŸ¢' },
      smash: { category: 'game', emoji: 'ðŸ’¥' },
      smoke: { category: 'visual', emoji: 'ðŸ’¨' },
      snake: { category: 'visual', emoji: 'ðŸ' },
      snow: { category: 'visual', emoji: 'â„ï¸' },
      snowflake: { category: 'visual', emoji: 'â„ï¸' },
      soccer: { category: 'visual', emoji: 'âš½' },
      solarsystem: { category: 'visual', emoji: 'â˜€ï¸' },
      soul: { category: 'visual', emoji: 'ðŸ‘»' },
      spark: { category: 'visual', emoji: 'âš¡' },
      spawn: { category: 'game', emoji: 'ðŸ”®' },
      speaker: { category: 'visual', emoji: 'ðŸ”ˆ' },
      speech: { category: 'ui', emoji: 'ðŸ’¬' },
      spider: { category: 'visual', emoji: 'ðŸ•·ï¸' },
      spill: { category: 'visual', emoji: 'ðŸ«—' },
      spin: { category: 'visual', emoji: 'ðŸ”„' },
      spiral: { category: 'visual', emoji: 'ðŸŒ€' },
      spiral2: { category: 'visual', emoji: 'ðŸš' },
      spirit: { category: 'visual', emoji: 'ðŸ‘»' },
      splash: { category: 'visual', emoji: 'ðŸ’¦' },
      splash2: { category: 'visual', emoji: 'ðŸŒŠ' },
      split: { category: 'visual', emoji: 'âœ‚ï¸' },
      split2: { category: 'visual', emoji: 'â†”ï¸' },
      spotlight: { category: 'visual', emoji: 'ðŸ”¦' },
      spring: { category: 'visual', emoji: 'ðŸŒ·' },
      square: { category: 'visual', emoji: 'ðŸ”²' },
      square2: { category: 'visual', emoji: 'â¬›' },
      squash: { category: 'visual', emoji: 'ðŸŽƒ' },
      stairs: { category: 'visual', emoji: 'ðŸªœ' },
      star2: { category: 'visual', emoji: 'â­' },
      stardust: { category: 'background', emoji: 'ðŸŒ ' },
      starfield: { category: 'background', emoji: 'ðŸŒƒ' },
      stars: { category: 'visual', emoji: 'â­' },
      static: { category: 'visual', emoji: 'ðŸ“º' },
      steam: { category: 'visual', emoji: 'â™¨ï¸' },
      stone: { category: 'visual', emoji: 'ðŸª¨' },
      stopwatch: { category: 'ui', emoji: 'â±ï¸' },
      storm: { category: 'visual', emoji: 'â›ˆï¸' },
      stream: { category: 'visual', emoji: 'ðŸŒŠ' },
      stream2: { category: 'visual', emoji: 'ðŸ“º' },
      stretch: { category: 'visual', emoji: 'ðŸ¤¸' },
      strike: { category: 'game', emoji: 'âš¡' },
      stripe: { category: 'visual', emoji: 'ðŸ“Š' },
      strobe: { category: 'visual', emoji: 'ðŸ’¡' },
      stun: { category: 'game', emoji: 'ðŸ˜µ' },
      stun2: { category: 'game', emoji: 'ðŸ’«' },
      success: { category: 'ui', emoji: 'âœ…' },
      summon: { category: 'game', emoji: 'ðŸ”®' },
      sun: { category: 'visual', emoji: 'â˜€ï¸' },
      sun2: { category: 'visual', emoji: 'ðŸŒž' },
      sunburst: { category: 'visual', emoji: 'ðŸŒ…' },
      sunflower: { category: 'visual', emoji: 'ðŸŒ»' },
      sunrise: { category: 'visual', emoji: 'ðŸŒ…' },
      sunset: { category: 'visual', emoji: 'ðŸŒ‡' },
      supernova: { category: 'visual', emoji: 'ðŸ’¥' },
      surge: { category: 'game', emoji: 'âš¡' },
      surprise: { category: 'visual', emoji: 'ðŸ˜²' },
      sushi: { category: 'visual', emoji: 'ðŸ£' },
      swarm: { category: 'visual', emoji: 'ðŸ' },
      sweat: { category: 'visual', emoji: 'ðŸ˜°' },
      swim: { category: 'visual', emoji: 'ðŸŠ' },
      swing: { category: 'visual', emoji: 'ðŸŽ ' },
      swirl: { category: 'visual', emoji: 'ðŸŒ€' },
      sync: { category: 'ui', emoji: 'ðŸ”„' },
      // === T ===
      tears2: { category: 'visual', emoji: 'ðŸ˜­' },
      teleport: { category: 'visual', emoji: 'ðŸŒ€' },
      temporal: { category: 'visual', emoji: 'â°' },
      tennis: { category: 'visual', emoji: 'ðŸŽ¾' },
      thought: { category: 'visual', emoji: 'ðŸ’­' },
      thread: { category: 'visual', emoji: 'ðŸ§µ' },
      thrill: { category: 'visual', emoji: 'ðŸŽ¢' },
      throw: { category: 'game', emoji: 'ðŸ¤¾' },
      thunder: { category: 'visual', emoji: 'â›ˆï¸' },
      tide: { category: 'visual', emoji: 'ðŸŒŠ' },
      timer: { category: 'ui', emoji: 'â²ï¸' },
      tornado: { category: 'visual', emoji: 'ðŸŒªï¸' },
      tower: { category: 'visual', emoji: 'ðŸ—¼' },
      trace: { category: 'visual', emoji: 'ðŸ”' },
      trail: { category: 'visual', emoji: 'ðŸ›¤ï¸' },
      transcend: { category: 'visual', emoji: 'ðŸ™' },
      transform: { category: 'visual', emoji: 'ðŸ”„' },
      treble: { category: 'visual', emoji: 'ðŸŽ¼' },
      tree: { category: 'visual', emoji: 'ðŸŒ³' },
      triangle: { category: 'visual', emoji: 'ðŸ”º' },
      trophy2: { category: 'ui', emoji: 'ðŸ†' },
      trumpet: { category: 'visual', emoji: 'ðŸŽº' },
      tsunami: { category: 'visual', emoji: 'ðŸŒŠ' },
      tulip: { category: 'visual', emoji: 'ðŸŒ·' },
      twist: { category: 'visual', emoji: 'ðŸŒ€' },
      typhoon: { category: 'visual', emoji: 'ðŸŒ€' },
      // === U ===
      unity: { category: 'visual', emoji: 'ðŸ¤' },
      unlock: { category: 'ui', emoji: 'ðŸ”“' },
      upload: { category: 'ui', emoji: 'ðŸ“¤' },
      // === V ===
      vibration: { category: 'visual', emoji: 'ðŸ“³' },
      violin: { category: 'visual', emoji: 'ðŸŽ»' },
      virus: { category: 'visual', emoji: 'ðŸ¦ ' },
      void: { category: 'visual', emoji: 'ðŸ•³ï¸' },
      void2: { category: 'visual', emoji: 'â¬›' },
      volcano: { category: 'visual', emoji: 'ðŸŒ‹' },
      vortex: { category: 'visual', emoji: 'ðŸŒ€' },
      // === W ===
      wall: { category: 'visual', emoji: 'ðŸ§±' },
      water: { category: 'visual', emoji: 'ðŸ’§' },
      waterfall: { category: 'visual', emoji: 'ðŸŒŠ' },
      wave: { category: 'visual', emoji: 'ðŸŒŠ' },
      wave2: { category: 'visual', emoji: 'ã€°ï¸' },
      wave3: { category: 'visual', emoji: 'ðŸ“Š' },
      wave4: { category: 'visual', emoji: 'ðŸŽµ' },
      web: { category: 'visual', emoji: 'ðŸ•¸ï¸' },
      whirlpool: { category: 'visual', emoji: 'ðŸŒ€' },
      wifi: { category: 'ui', emoji: 'ðŸ“¶' },
      wind: { category: 'visual', emoji: 'ðŸ’¨' },
      window2: { category: 'visual', emoji: 'ðŸªŸ' },
      wings: { category: 'visual', emoji: 'ðŸª½' },
      wipe: { category: 'visual', emoji: 'ðŸ§¹' },
      wood: { category: 'visual', emoji: 'ðŸªµ' },
      wormhole: { category: 'visual', emoji: 'ðŸ•³ï¸' },
      wrench: { category: 'visual', emoji: 'ðŸ”§' },
      // === Y ===
      yawn: { category: 'visual', emoji: 'ðŸ¥±' },
      // === Z ===
      zigzag: { category: 'visual', emoji: 'âš¡' },
      zodiac: { category: 'visual', emoji: 'â™ˆ' },
      zoom2: { category: 'visual', emoji: 'ðŸ”Ž' },
      zoom3: { category: 'visual', emoji: 'ðŸ”­' },
    };

    // Import effects from built JS
    import { allEffects, getEffectByName } from './dist/effects/index.js';
    import { ParticleSystem } from './dist/core.js';

    // Initialize
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // Set initial canvas size before ParticleSystem initialization
    const container = canvas.parentElement;
    canvas.width = container.clientWidth;
    canvas.height = container.clientHeight;
    canvas.style.width = canvas.width + 'px';
    canvas.style.height = canvas.height + 'px';

    // Initialize ParticleSystem with correct canvas size
    const system = new ParticleSystem(canvas, { width: canvas.width, height: canvas.height });

    // Resize canvas to fit container
    function resizeCanvas() {
      const container = canvas.parentElement;
      canvas.width = container.clientWidth;
      canvas.height = container.clientHeight;
      canvas.style.width = canvas.width + 'px';
      canvas.style.height = canvas.height + 'px';
      // Update ParticleSystem config to match new canvas size
      system.updateConfig({ width: canvas.width, height: canvas.height });
    }
    window.addEventListener('resize', resizeCanvas);

    // Register all effects
    allEffects.forEach(effect => system.registerEffect(effect));

    // Update effect count
    document.getElementById('effectCount').textContent = allEffects.length;

    // Generate tabs
    const categories = ['all', 'ui', 'visual', 'game', 'background'];
    const tabsContainer = document.getElementById('tabs');
    categories.forEach((cat, i) => {
      const btn = document.createElement('button');
      btn.className = 'tab' + (i === 0 ? ' active' : '');
      btn.dataset.category = cat;
      btn.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
      btn.onclick = () => filterEffects(cat);
      tabsContainer.appendChild(btn);
    });

    // Generate effect buttons
    const grid = document.getElementById('effectsGrid');
    let currentEffect = allEffects[0]?.config.name || 'success';

    allEffects.forEach(effect => {
      const name = effect.config.name;
      const meta = EFFECT_META[name] || { category: 'visual', emoji: 'ðŸ”·' };
      const btn = document.createElement('button');
      btn.className = 'effect-btn' + (name === currentEffect ? ' selected' : '');
      btn.dataset.effect = name;
      btn.dataset.category = meta.category;
      btn.textContent = meta.emoji + ' ' + name;
      btn.onclick = () => selectEffect(name);
      grid.appendChild(btn);
    });

    function selectEffect(name) {
      currentEffect = name;
      document.querySelectorAll('.effect-btn').forEach(btn => {
        btn.classList.toggle('selected', btn.dataset.effect === name);
      });
    }

    // Category and search state
    let currentCategory = 'all';
    let currentSearchQuery = '';

    function filterEffects(category) {
      currentCategory = category;
      document.querySelectorAll('.tab').forEach(t => {
        t.classList.toggle('active', t.dataset.category === category);
      });
      applyFilters();
    }

    function applyFilters() {
      document.querySelectorAll('.effect-btn').forEach(btn => {
        const name = btn.dataset.effect.toLowerCase();
        const matchesSearch = currentSearchQuery === '' || name.includes(currentSearchQuery);
        const matchesCategory = currentCategory === 'all' || btn.dataset.category === currentCategory;
        btn.style.display = (matchesSearch && matchesCategory) ? '' : 'none';
      });
    }

    // Search input handler
    document.getElementById('searchInput').oninput = (e) => {
      currentSearchQuery = e.target.value.toLowerCase();
      applyFilters();
    };

    // Random mode state
    let randomMode = false;

    // Canvas click handler
    canvas.addEventListener('click', (e) => {
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      const x = (e.clientX - rect.left) * scaleX;
      const y = (e.clientY - rect.top) * scaleY;
      const intensity = parseFloat(document.getElementById('intensity').value);

      // Select effect based on mode
      let effectName;
      if (randomMode) {
        const filtered = getFilteredEffects(allEffects, currentCategory, EFFECT_META);
        const randomEffect = selectRandomEffect(filtered);
        effectName = randomEffect ? randomEffect.config.name : currentEffect;
      } else {
        effectName = currentEffect;
      }

      system.trigger(effectName, x, y, { intensity });
      document.getElementById('lastEffect').textContent = effectName;
    });

    // Controls
    document.getElementById('intensity').oninput = (e) => {
      document.getElementById('intensityValue').textContent = parseFloat(e.target.value).toFixed(1);
    };

    let autoPlay = false;
    let autoInterval;
    document.getElementById('autoBtn').onclick = () => {
      autoPlay = !autoPlay;
      document.getElementById('autoBtn').classList.toggle('auto-active', autoPlay);
      document.getElementById('autoBtn').textContent = autoPlay ? 'Stop' : 'Auto Play';
      if (autoPlay) {
        autoInterval = setInterval(() => {
          const x = Math.random() * canvas.width;
          const y = Math.random() * canvas.height;
          const intensity = parseFloat(document.getElementById('intensity').value);
          // Random effect
          const randomEffect = allEffects[Math.floor(Math.random() * allEffects.length)];
          system.trigger(randomEffect.config.name, x, y, { intensity });
        }, 500);
      } else {
        clearInterval(autoInterval);
      }
    };

    document.getElementById('clearBtn').onclick = () => system.clear();

    // Random mode toggle
    document.getElementById('randomBtn').onclick = () => {
      randomMode = !randomMode;
      document.getElementById('randomBtn').classList.toggle('random-active', randomMode);
      document.getElementById('randomBtn').textContent = randomMode ? 'Random ON' : 'Random';
    };

    // Stats
    let lastTime = performance.now();
    let frameCount = 0;
    function updateStats() {
      frameCount++;
      const now = performance.now();
      if (now - lastTime >= 1000) {
        document.getElementById('fps').textContent = frameCount;
        frameCount = 0;
        lastTime = now;
      }
      document.getElementById('particleCount').textContent = system.getParticleCount();
      requestAnimationFrame(updateStats);
    }
    updateStats();

    // Start
    system.start();
  </script>
</body>
</html>
